!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.pixelit=e()}(this,function(){"use strict";function t(t){this.config={to:document.getElementById("pixelit-canvas"),from:document.getElementById("pixelit-img"),scale:8,palette:[[0,0,0],[255,255,255]],maxHeight:null,maxWidth:null},t&&Object.assign(this.config,t),this.config.to||(this.config.to=document.createElement("canvas"),this.config.to.id="pixelit-canvas"),this.to=this.config.to,this.from=this.config.from,this.scale=this.config.scale>30?30:this.config.scale,this.palette=this.config.palette,this.ctx=this.to.getContext("2d"),this.from.width>0&&this.from.height>0?(this.config.maxWidth&&this.from.width>this.config.maxWidth?this.from.width=this.config.maxWidth:null,this.config.maxHeight&&this.from.height>this.config.maxHeight?this.from.height=this.config.maxHeight:null,this.to.width=this.from.width,this.to.height=this.from.height,this.from.tagName.toLowerCase()==="canvas"?this.img=this.from:this.img=new Image,this.img.crossOrigin="anonymous",this.img.src=this.from.src):console.log("Check that your from element has width and height.")}return t.prototype.setFrom=function(t){return this.from=t,this},t.prototype.setTo=function(t){return this.to=t,this},t.prototype.setPalette=function(t){return this.palette=t,this},t.prototype.setScale=function(t){return this.scale=t>30?30:t,this},t.prototype.draw=function(){return this.ctx.drawImage(this.img,0,0,this.to.width,this.to.height),this},t.prototype.pixelate=function(){var t=this.to.width/this.scale,e=this.to.height/this.scale;this.ctx.clearRect(0,0,this.to.width,this.to.height);for(var i=0;i<this.scale;i++)for(var s=0;s<this.scale;s++){var o=this.ctx.getImageData(s*t,i*e,t,e).data,h=this.averageColor(o);this.ctx.fillStyle=this.similarColor(h),this.ctx.fillRect(s*t,i*e,t,e)}return this},t.prototype.saveImage=function(){var t=this.to.toDataURL("image/png").replace("image/png","image/octet-stream"),e=document.createElement("a");e.href=t,e.download="pixelit-download.png",e.click()},t.prototype.averageColor=function(t){for(var e=0,i=0,s=0,o=0;o<t.length;o+=4)e+=t[o],i+=t[o+1],s+=t[o+2];return[Math.floor(e/(t.length/4)),Math.floor(i/(t.length/4)),Math.floor(s/(t.length/4))]},t.prototype.similarColor=function(t){for(var e,i,s,o=1e6,h=0;h<this.palette.length;h++)(e=t[0]-this.palette[h][0])*(e/=1)+(i=t[1]-this.palette[h][1])*(i/=1)+(s=t[2]-this.palette[h][2])*(s/=1)<o&&(o=e*e+i*i+s*s,this.finalColor=this.palette[h]);return"rgb("+this.finalColor[0]+","+this.finalColor[1]+","+this.finalColor[2]+")"},t.palette=function(){return{fivebit:[[0,0,0],[0,0,131],[0,68,0],[0,139,139],[131,0,0],[131,0,131],[115,50,0],[192,192,192],[128,128,128],[0,0,255],[0,255,0],[0,255,255],[255,0,0],[255,0,255],[255,255,0],[255,255,255]],cga:[[0,0,0],[85,255,255],[255,85,255],[255,255,255]],vga:[[0,0,0],[0,0,170],[0,170,0],[0,170,170],[170,0,0],[170,0,170],[170,85,0],[170,170,170],[85,85,85],[85,85,255],[85,255,85],[85,255,255],[255,85,85],[255,85,255],[255,255,85],[255,255,255]],bw:[[0,0,0],[255,255,255]],original:null}},t.prototype.saveAs=function(t){var e=this.to.toDataURL("image/png").replace("image/png","image/octet-stream"),i=document.createElement("a");i.href=e,i.download=t||"pixelit-download.png",i.click()},t});
